!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("jsqr"),require("@angular/core")):"function"==typeof define&&define.amd?define("ngx-scanner-qrcode",["exports","rxjs","jsqr","@angular/core"],e):e(t["ngx-scanner-qrcode"]={},t.rxjs,t.jsqr,t.ng.core)}(this,function(t,o,A,e){"use strict";A=A&&A.hasOwnProperty("default")?A["default"]:A;var l=function(){return(l=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},i={audio:!1,video:!0},n={src:"",isAuto:!1,isBeep:!0,isAlwaysEmit:!1,medias:i},a=function(t,e,i){void 0===i&&(i=null),i?t.error(i):t.next(e),t.complete()},c=function(t){if(void 0===t&&(t=!1),!1!==t){var e=new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");e.oncanplaythrough=function(){var t=e.play();t&&t["catch"](function(t){"NotAllowedError"===t.name||t.name})}}},r=function(t,e){for(var i=e.split("."),n=0;n<i.length;n++){var o=i[n];if(!t.hasOwnProperty(o))return!1;t=t[o]}return!0},d=function(t,e,i){var n,o,a=e.width,r=e.height,s=a/r,A=parseInt(getComputedStyle(e).width),l=parseInt(getComputedStyle(e).height),c=A/l,d=document.createElement("canvas"),u=d.getContext("2d",{willReadFrequently:!0});u.globalCompositeOperation="destination-over";var h={};h.x1=t.location.topLeftCorner.x,h.y1=t.location.topLeftCorner.y,h.x2=t.location.topRightCorner.x,h.y2=t.location.topRightCorner.y,h.x3=t.location.bottomLeftCorner.x,h.y3=t.location.bottomLeftCorner.y,h.x4=t.location.bottomRightCorner.x,h.y4=t.location.bottomRightCorner.y;var p=[h.x1,h.x2,h.x3,h.x4],v=[h.y1,h.y2,h.y3,h.y4],m=Math.max(h.x1,h.x2,h.x3,h.x4),f=Math.min(h.x1,h.x2,h.x3,h.x4),y=Math.max(h.y1,h.y2,h.y3,h.y4),g=Math.min(h.y1,h.y2,h.y3,h.y4),x=v[p.indexOf(f)],E=p[v.indexOf(g)],w=v[p.indexOf(m)],b=p[v.indexOf(y)];c<s?(n=A/a,o=A/s/r,d.style.top=g*o+.5*(l-A/s)+"px",d.style.left=f*n+"px",d.width=(m-f)*n,d.height=(y-g)*n,d.style.width=(m-f)*n+"px",d.style.height=(y-g)*n+"px"):(o=l/r,n=l*s/a,d.style.top=g*o+"px",d.style.left=f*n+.5*(A-l*s)+"px",d.width=(m-f)*o,d.height=(y-g)*o,d.style.width=(m-f)*o+"px",d.style.height=(y-g)*o+"px"),d.style.zIndex="1",d.style.position="absolute",u.fillStyle="#55f02880";var I,Q;if(I=Math.floor(h.x1)-Math.floor(h.x3),Q=Math.floor(h.x2)-Math.floor(h.x4),~~I<=1&&~~Q<=1&&t.location.topLeftFinderPattern.y==t.location.topRightFinderPattern.y)u.fillRect(0,0,d.width,d.height);else{var S=x*o-g*o,C=E*n-f*n,B=w*o-g*o,k=b*n-f*n;u.beginPath(),u.moveTo(0,S),u.lineTo(C,0),u.lineTo(d.width,B),u.lineTo(k,d.height),u.fill()}var D=document.createElement("div");D.setAttribute("class","qrcode-tooltip-temp"),D.innerHTML=t.data;var L=document.createElement("div");L.setAttribute("class","qrcode-tooltip"),L.appendChild(D),o=l/r,n=l*s/a,L.style.fontSize=15*n+"px",L.style.top=g*o+"px",L.style.left=f*n+.5*(A-l*s)+"px",L.style.width=(m-f)*o+"px",L.style.height=(y-g)*o+"px";var R=document.createElement("input");return R.value=t.data,R.style.zIndex="3",R.style.fontSize=15*n+"px",R.style.color="red",R.style.border="none",R.style.outline="none",R.style.position="absolute",R.style.background="#ffffff00",R.style.width="-webkit-fill-available",R.style.minWidth=L.style.width,R.setAttribute("class","qrcode-data"),R.style.top=g*o+-20*o+"px",R.style.left=f*n+.5*(A-l*s)+"px",i&&(i.innerHTML="",i.appendChild(d),i.appendChild(R),i.appendChild(L)),d},s=function(){function t(){}return t.prototype.loadFiles=function(t){var e=this;void 0===t&&(t=[]);var i=new o.AsyncSubject;return Promise.all(Object.assign([],t).map(function(t){return e.readAsDataURL(t)})).then(function(t){return a(i,t)})["catch"](function(t){return a(i,null,t)}),i},t.prototype.readAsDataURL=function(o){return new Promise(function(e,i){var n=new FileReader;n.onload=function(){var t={name:o.name,file:o,base64:n.result,url:URL.createObjectURL(o)};e(t)},n.onerror=function(t){return i(t)},n.readAsDataURL(o)})},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=e.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),u=function(){function t(){this.error=new e.EventEmitter,this.event=new e.EventEmitter,this.src=n.src,this.isAuto=n.isAuto,this.isBeep=n.isBeep,this.isAlwaysEmit=n.isAlwaysEmit,this.config=n,this.medias=n.medias,this.isStart=!1,this.isLoading=!1,this.data=new o.BehaviorSubject({})}return t.prototype.ngOnInit=function(){this.overrideConfig(),this.src?this.loadImage(this.src):this.isAuto&&this.start(),this.resize()},t.prototype.start=function(){var e=this,i=new o.AsyncSubject;return this.isStart?a(i,!1):(this.status(!1,!0),navigator.mediaDevices.getUserMedia(this.medias).then(function(t){e.video.nativeElement.srcObject=t,e.video.nativeElement.onloadedmetadata=function(){e.video.nativeElement.play(),e.requestAnimationFrame(),e.status(!0,!1),a(i,!0)}})["catch"](function(t){e.status(!1,!1),e.eventEmit(!1,t),a(i,!1,t)})),i},t.prototype.stop=function(){this.eventEmit(null),this.status(!1,!1);var e=new o.AsyncSubject;try{this.removeCanvas(),clearInterval(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(function(t){t.stop(),a(e,!0)})}catch(t){this.eventEmit(!1,t),a(e,!1,t)}return e},t.prototype.play=function(){var t=new o.AsyncSubject;return this.isPause?(this.video.nativeElement.play(),this.requestAnimationFrame(),a(t,!0)):a(t,!1),t},t.prototype.pause=function(){var t=new o.AsyncSubject;return this.isStart?(clearInterval(this.rAF_ID),this.video.nativeElement.pause(),a(t,!0)):a(t,!1),t},t.prototype.loadImage=function(t){var e=this,i=new o.AsyncSubject;this.status(!1,!0);var n=new Image;return n.setAttribute("crossOrigin","anonymous"),n.onload=function(){e.drawImage(n,function(t){e.status(!1,!1),a(i,t)})},n.src=t,i},t.prototype.resize=function(){var e=this;window.addEventListener("resize",function(){return e.data.subscribe(function(t){r(t,"location")&&d(t,e.canvas.nativeElement,e.resultsPanel.nativeElement)})})},t.prototype.overrideConfig=function(){r(this.config,"src")&&(this.src=this.config.src),r(this.config,"isAuto")&&(this.isAuto=this.config.isAuto),r(this.config,"isBeep")&&(this.isBeep=this.config.isBeep),r(this.config,"isAlwaysEmit")&&(this.isAlwaysEmit=this.config.isAlwaysEmit),r(this.config,"medias")&&(this.medias=function(t,e,i){var n;if(e&&Object.keys(e[t]).length){for(var o in i){var a=JSON.parse(JSON.stringify(l({},e[t],((n={})[o]=i[o],n))));e[t]=e[t].hasOwnProperty(o)?e[t]:a}return e[t]}return i}("medias",this.config,i))},t.prototype.drawImage=function(t,e){var i=this;void 0===e&&(e=function(){});var n=this.canvas.nativeElement,o=n.getContext("2d",{willReadFrequently:!0});t instanceof HTMLImageElement&&(n.width=t.naturalWidth,n.height=t.naturalHeight,t.style.visibility="",this.video.nativeElement.style.visibility="hidden"),t instanceof HTMLVideoElement&&(n.width=t.videoWidth,n.height=t.videoHeight,t.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),o.drawImage(t,0,0,n.width,n.height);var a=o.getImageData(0,0,n.width,n.height),r=A(a.data,a.width,a.height,{inversionAttempts:"attemptBoth"});if(r){d(r,Object.freeze(this.canvas.nativeElement),this.resultsPanel.nativeElement);var s=function(){return i.eventEmit(l({},r,{canvas:n}))};t instanceof HTMLImageElement&&(e(!0),s(),c(this.isBeep)),t instanceof HTMLVideoElement&&(this.isAlwaysEmit?(s(),c(this.isBeep)):r.data!==this.data.value.data&&(s(),c(this.isBeep)))}else e(!1),this.removeCanvas()},t.prototype.removeCanvas=function(){var e=this;Object.assign([],this.resultsPanel.nativeElement.childNodes).forEach(function(t){return e.resultsPanel.nativeElement.removeChild(t)})},t.prototype.status=function(t,e){this.isStart=t,this.isLoading=e},t.prototype.eventEmit=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),!1!==t&&this.data.next(t||{data:null}),!1!==t&&this.event.emit(t||{data:null}),!1!==e&&this.error.emit(e||null)},t.prototype.requestAnimationFrame=function(){var t=this;this.rAF_ID=setInterval(function(){t.video.nativeElement.readyState===t.video.nativeElement.HAVE_ENOUGH_DATA&&t.drawImage(t.video.nativeElement)},40)},Object.defineProperty(t.prototype,"isPause",{get:function(){return this.isStart&&this.video.nativeElement.paused},enumerable:!0,configurable:!0}),t.prototype.ngOnDestroy=function(){this.pause()},t.decorators=[{type:e.Component,args:[{selector:"ngx-scanner-qrcode",template:'<div #resultsPanel class="origin-overlay"></div>\r\n<canvas #canvas class="origin-canvas"></canvas>\r\n<video #video playsinline class="origin-video"></video>',host:{"class":"ngx-scanner-qrcode"},exportAs:"scanner",inputs:["src","isAuto","isBeep","isAlwaysEmit","config","medias"],outputs:["event","error"],queries:{video:new e.ViewChild("video"),canvas:new e.ViewChild("canvas"),resultsPanel:new e.ViewChild("resultsPanel")},encapsulation:e.ViewEncapsulation.None,styles:[".ngx-scanner-qrcode{width:100%;position:relative;background-color:#262626;display:flex;justify-content:center;align-items:center}.origin-overlay{position:absolute;width:100%;height:100%}.origin-canvas{-o-object-fit:contain;object-fit:contain;position:absolute;width:100%;height:100%}.origin-video{width:100%;height:100%}.qrcode-tooltip{position:absolute;z-index:2}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute}.qrcode-tooltip-temp{bottom:0;z-index:3;left:50%;padding:10px;display:none;width:-moz-max-content;width:max-content;word-wrap:break-word;max-width:450px;box-shadow:1px 1px 20px #000000e0;border-radius:5px;background-color:#000000d0;transform:translate(-50%);transform-style:preserve-3d;color:#fff;text-align:left}.qrcode-data{position:absolute;top:-20px;color:red}"]}]}],t}(),h=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[u],exports:[u],providers:[s]}]}],t}();t.NgxScannerQrcodeService=s,t.NgxScannerQrcodeComponent=u,t.NgxScannerQrcodeModule=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-scanner-qrcode.umd.min.js.map